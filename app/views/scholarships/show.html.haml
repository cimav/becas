%nav.config-breadcrumb.z-depth-0
  .nav-wrapper
    .row
      .col.s12.m12.l12
        =link_to root_path, class:'breadcrumb' do
          Listado de becas
        %a.breadcrumb{}
          =@scholarship.scholarship_type.name


.row
  .card
    .card-content
      .card-title
        Información de la beca
      .row
        .col.s12.m1
          %img.responsive-img.circle{src:"http://posgrado.cimav.edu.mx/imagen/#{@scholarship.person_type.downcase}/#{@scholarship.person_id}"}
        .col.s12.m11
          .right.valign-wrapper
            %i.material-icons.left{class:status_color(@scholarship.status)}
              lens
            =@scholarship.get_status
          %h4
            = @scholarship.person.full_name
          .row
            .col.s12.m6
              -if @scholarship.person_type.eql?'Student'
                %p
                  %b Programa:
                  =@scholarship.person.program.name
              %p
                %b Curp:
                -if !@scholarship.person.curp.blank?
                  = @scholarship.person.curp
                -else
                  %span.red-text
                    Sin capturar
              %p
                %b Correo electrónico:
                -if !@scholarship.person.email.blank?
                  = @scholarship.person.email
                -else
                  %span.red-text
                    Sin capturar
              %p
                %b Fecha de inicio (beca):
                -if !@scholarship.start_date.blank?
                  = f_date_no_time(@scholarship.start_date)
                -else
                  %span.red-text
                    Sin capturar
              %p
                %b Fecha de inicio (beca):
                -if !@scholarship.end_date.blank?
                  = f_date_no_time(@scholarship.end_date)
                -else
                  %span.red-text
                    Sin capturar
              %p
                %b Tipo de beca:
                = @scholarship.scholarship_type.name
              %p
                %b Docente responsable:
                = @scholarship.person.staff.full_name
              %p
                %b Proyecto:
                -if !@scholarship.project_number.blank?
                  = @scholarship.project_number
                -else
                  %span.red-text
                    Sin capturar
              -if is_admin?
                %p
                  %b Número de solicitud:
                  -if !@scholarship.request_number.blank?
                    = @scholarship.request_number
                  -else
                    %span.red-text
                      Sin capturar
            .col.s12.m6
              %table.grey.lighten-4
                %thead
                  %tr
                    %th
                      Concepto
                    %th
                      Cantidad
                %tbody
                  %tr
                    %th
                      Monto máximo
                    %td
                      = number_to_currency(@scholarship.max_amount,unit: "$", separator: ".", delimiter: ",", format: "%u%n")
                  %tr
                    %th
                      Porcentaje
                    %td
                      = "#{@scholarship.percent}%"
                  %tr.grey.lighten-2
                    %th
                      Monto
                    %th
                      = number_to_currency(@scholarship.amount,unit: "$", separator: ".", delimiter: ",", format: "%u%n")
      -if is_admin?
        -if @scholarship.person_type.eql?'Internship'
          %a.btn-floating.btn-large.waves-effect.waves-light.grey.darken-2.tooltipped{href:"/scholarships/#{@scholarship.id}/formato_solicitud_cep",'data-tooltip':"Formato de solicitud CEP",'data-delay':30, target:'_blank'}
            %i.material-icons insert_drive_file
        -if @comments.size==0
          %button.btn-floating.btn-large.waves-effect.waves-light.purple.tooltipped{'data-tooltip':"Escribir comentario",'data-delay':30, onclick:"openModal($('#new_comment_modal'));"}
            %i.material-icons insert_comment
        %button.btn-floating.btn-large.waves-effect.waves-light.indigo.tooltipped{'data-tooltip':"Cambiar estatus",'data-delay':30, onclick:"openModal($('#change_status_modal'));"}
          %i.material-icons gavel
-if @comments.size>0
  .row
    .card
      .card-content
        .card-title
          Mensajes
        %ul.collapsible
          %li
            .collapsible-header
              Mensajes
              %span.badge{'data-badge-caption':"#{@comments.size==1?'Mensaje':'Mensajes'}"}
                =@comments.size
            .collapsible-body
              =render 'scholarship_messages'
        .right-align
          %button.btn-floating.btn-large.waves-effect.waves-light.purple.tooltipped{'data-tooltip':"Responder", onclick:"openModal($('#new_comment_modal'));"}
            %i.material-icons insert_comment


.row
  .card
    .card-content
      .card-title
        Documentos
        %a.btn-floating.right
          %i.material-icons.green.darken-2{onclick:"openModal($('#upload_file_modal'));"}
            add
      #internship_files
        :javascript
          refreshInternshipFiles("#{@scholarship.id}");



-if @scholarship.status.eql?Scholarship::REQUESTED
  .fixed-action-btn
    %a.btn-floating.btn-large.blue.darken-2
      %i.material-icons
        more_vert
    %ul
      %li
        %a.btn-floating.blue.tooltipped{href:"#{edit_scholarship_path}","data-position":"left", "data-tooltip": "Editar beca","data-delay":40}
          %i.material-icons
            edit
-if is_admin?
  .fixed-action-btn
    %button.btn-floating.btn-large.blue.darken-2
      %i.material-icons
        more_vert
    %ul
      %li
        %a.btn-floating.blue.tooltipped{href:"#{edit_scholarship_path}","data-position":"left", "data-tooltip": "Editar beca","data-delay":40}
          %i.material-icons
            edit







#new_comment_modal.modal
  .modal-content
    %h5 Escribir comentario
    .row
      =form_for ScholarshipComment.new, url:"/scholarships/#{@scholarship.id}/create_comment", class:'col s12 m12' do |f|
        .input-field.col.s12.m12
          =f.label :content,'Mensaje'
          =f.text_area :content, class:'materialize-textarea'
        .input-field.col.s12.m12.right-align
          %button.btn-floating.green.darken-1{type:'submit',value:"Submit"}
            %i.material-icons
              send
#change_status_modal.modal
  .modal-content
    %h5 Cambiar estatus
    =form_for @scholarship, class:'col s12 m12' do |f|
      .row
        .input-field.col.s12.m12
          =f.label :status,'Mensaje', class:'active'
          =f.select :status, Scholarship::STATUS.except(Scholarship::DELETED).invert
        .input-field.col.s12.m12.right-align
          %button.btn-floating.green.darken-1{type:'submit',value:"Submit"}
            %i.material-icons
              send
#upload_file_modal.modal
  .modal-content
    %h5 Subir documento
    =form_for InternshipFile.new, url:"/scholarships/#{@scholarship.id}/upload_internship_file", class:'col s12 m12' do |f|
      .row
        .input-field.col.s12.m12
          =f.label :file_type,'Tipo de documento', class:'active'
          =f.select :file_type, InternshipFile::REQUESTED_DOCUMENTS.except(InternshipFile::COURSE,InternshipFile::NORMAL,InternshipFile::SIGN_REQUEST).invert
        .input-field.col.s12.m12
          =f.file_field :file
        .input-field.col.s12.m12.right-align
          %button.btn-floating.green.darken-1{type:'submit',value:"Submit"}
            %i.material-icons
              send
:javascript
  $(document).ready(function(){
    // the "href" attribute of the modal trigger must specify the modal ID that wants to be triggered
    $('.modal').modal('close');
  });
